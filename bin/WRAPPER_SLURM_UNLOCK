#!/bin/bash
#SBATCH --job-name="seq_pipeline"
#SBATCH --partition="niddk,norm"
#SBATCH --cpus-per-task=4
#SBATCH --time=120:00:00
#SBATCH --mem=12G
source activate ncbi_remap

SNAKEFILE=$1

# Make required folders
LOGS=../output/logs
if [[ ! -e $LOGS ]]; then mkdir -p $LOGS; fi
if [[ ! -e slurm_logs ]]; then mkdir -p slurm_logs; fi

# Start mongo
#mongod --dbpath ../output/db --logpath ../output/logs/mongoDB.log --port 27022 --fork
mongod --dbpath ../output/db --logpath ../output/logs/mongoDB.log --fork
hostname > .mongodb_host

# run pipeline
snakemake \
    -s $SNAKEFILE \
    --unlock

mongod --dbpath ../output/db --shutdown
rm .mongodb_host
