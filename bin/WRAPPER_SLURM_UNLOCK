#!/bin/bash
#SBATCH --job-name="seq_pipeline"
#SBATCH --partition="niddk,norm"
#SBATCH --cpus-per-task=4
#SBATCH --time=120:00:00
#SBATCH --mem=12G
#SBATCH --output=../output/logs/slurm-%j.out
#SBATCH --error=../output/logs/slurm-%j.out
source activate ncbi_remap

SNAKEFILE=$1

# Make required folders
WORKDIR=../.`basename $SNAKEFILE .snake`
if [[ ! -e $WORKDIR/slurm_logs ]]; then mkdir -p $WORKDIR/slurm_logs; fi

# Start mongo
./start_db.sh

# run pipeline
snakemake \
    -s $SNAKEFILE \
    --unlock

# Stop mongo
./stop_db.sh
